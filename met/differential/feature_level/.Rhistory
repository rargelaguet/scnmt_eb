) %>% rbindlist() %>% .[,lineage:="Ectoderm"]
# Endoderm-specific
diff.acc.end <- lapply(names(opts$acc.annos), function(x)
fread(sprintf("zcat < %s/E7.5End_vs_E7.5EctMes_%s.txt.gz",io$diff.acc,x))
) %>% rbindlist() %>% .[,lineage:="Endoderm"]
diff.acc <- do.call("rbind", list(diff.acc.mes,diff.acc.end,diff.acc.ect))# %>%
# .[,sig:=padj_fdr<0.01 & abs(diff)>0.15]
diff.met <- diff.met %>%
.[,anno:=stringr::str_replace_all(anno,opts$met.annos)] %>%
.[,id:=stringr::str_replace_all(id,"_500","")] %>%
.[,c("id","anno","diff","padj_fdr","sig","lineage")]
diff.acc <- diff.acc %>%
.[,anno:=stringr::str_replace_all(anno,opts$acc.annos)] %>%
.[,c("id","anno","diff","padj_fdr","sig","lineage")]
diff.metacc <- rbind(
diff.met[,type:="met"],
diff.acc[,type:="acc"]
) %>% dcast(id+anno+lineage~type, value.var=c("padj_fdr","diff","sig"))# %>% .[complete.cases(.)]
feature_metadata_filt <- feature_metadata %>% copy %>%
.[,anno:=stringr::str_replace_all(anno,opts$met.annos)] %>%
.[,id:=stringr::str_replace_all(id,"_500","")] %>%
split(.$anno) %>%
map2(.,names(.), function(x,y) x[id %in% unique(as.character(diff.metacc[anno==y,id]))] ) %>%
rbindlist
gene_metadata_filt <- gene_metadata %>% .[,c("chr","start","end","gene")] %>%
.[,c("start", "end") := list(start-opts$gene_window, end+opts$gene_window)] %>%
setkey(chr,start,end)
tmp_list <- list()
for (ann in unique(diff.metacc$anno)){
# Subset corresponding anno
tmp <- diff.metacc[anno==ann, ]
# Non gene-associated feature
if (all(grepl("ENSMUSG", unique(tmp$id)) == FALSE)) {
# Extract coordiantes for methylation sites and for genes
feature_metadata_tmp <- feature_metadata_filt[anno==ann, c("chr","start","end","id")] %>%
.[,c("start","end") := list(start - opts$gene_window, end + opts$gene_window)] %>% setkey(chr,start,end)
# Do the overlap
ov <- foverlaps(gene_metadata_filt, feature_metadata_tmp, nomatch=0) %>% .[,c("gene", "id")]
# Merge with methylation data
tmp_list[[ann]] <- merge(tmp, ov, by="id", allow.cartesian=T)
}
# Gene-associated feature
else if (all(grepl("ENSMUSG", unique(tmp$id)) == TRUE)) {
tmp_list[[ann]] <- merge(tmp, gene_metadata[,c("id","gene")], by="id")
}
}
diff.metacc <- rbindlist(tmp_list)
diff.metacc <- diff.metacc %>% split(.$anno) %>% map(~ .[,.SD[which.min(padj_fdr_met)], by=c("gene","lineage")]) %>% rbindlist
diff.metaccrna <- diff.metacc %>% merge(diff.rna[,c("gene","diff_rna","sig_rna","lineage")], by=c("gene","lineage"))
tmp <- diff.metaccrna %>%
.[,.(Nmet=mean(sig_met,na.rm=T), Nacc=mean(sig_acc,na.rm=T)), by=c("anno","lineage")] %>%
melt(id.vars=c("anno","lineage"), variable.name="assay", value.name="N")
# Mesoderm
foo <- tmp[grep("End|Ect",anno,invert=T)] %>% .[lineage=="Mesoderm"]
p_mes <- ggplot(foo, aes(x=anno, y=N)) +
geom_bar(stat="identity", position="dodge", color="black", size=0.25) +
facet_wrap(~assay, nrow=2) +
theme_bw()
print(p_mes)
# Endoderm
foo <- tmp[grep("Mes|Ect",anno,invert=T)] %>% .[lineage=="Endoderm"]
p_end <- ggplot(foo, aes(x=anno, y=N)) +
geom_bar(stat="identity", position="dodge", color="black", size=0.25) +
facet_wrap(~assay, nrow=2) +
theme_bw()
print(p_end)
tmp <- diff.metaccrna %>%
.[,.(Nmet=mean(sig_met,na.rm=T), Nacc=mean(sig_acc,na.rm=T)), by=c("anno","lineage")] %>%
melt(id.vars=c("anno","lineage"), variable.name="assay", value.name="N")
# Mesoderm
# foo <- tmp[grep("End|Ect",anno,invert=T)] %>% .[lineage=="Mesoderm"]
foo <- tmp[lineage=="Mesoderm"]
p_mes <- ggplot(foo, aes(x=anno, y=N)) +
geom_bar(stat="identity", position="dodge", color="black", size=0.25) +
facet_wrap(~assay, nrow=2) +
theme_bw()
print(p_mes)
# Endoderm
foo <- tmp[lineage=="Endoderm"]
p_end <- ggplot(foo, aes(x=anno, y=N)) +
geom_bar(stat="identity", position="dodge", color="black", size=0.25) +
facet_wrap(~assay, nrow=2) +
theme_bw()
print(p_end)
p_mes <- ggplot(foo, aes(x=anno, y=N)) +
geom_bar(aes(fill=assay), stat="identity", position="dodge", color="black", size=0.25) +
scale_fill_manual(values=c("Nmet"="#F37A71", "Nacc"="#00BFC4"))
# Mesoderm
# foo <- tmp[grep("End|Ect",anno,invert=T)] %>% .[lineage=="Mesoderm"]
foo <- tmp[lineage=="Mesoderm"]
p_mes <- ggplot(foo, aes(x=anno, y=N)) +
geom_bar(aes(fill=assay), stat="identity", position="dodge", color="black", size=0.25) +
scale_fill_manual(values=c("Nmet"="#F37A71", "Nacc"="#00BFC4"))
p_mes <- ggplot(foo, aes(x=anno, y=N)) +
geom_bar(aes(fill=assay), stat="identity", position="dodge", color="black", size=0.25) +
scale_fill_manual(values=c("Nmet"="#F37A71", "Nacc"="#00BFC4")) +
facet_wrap(~assay, nrow=2) +
theme_bw()
print(p_mes)
p_mes <- ggplot(foo, aes(x=anno, y=N)) +
geom_bar(aes(fill=assay), stat="identity", position="dodge", color="black", size=0.25) +
scale_fill_manual(values=c("Nmet"="#F37A71", "Nacc"="#00BFC4")) +
facet_wrap(~assay, nrow=2) +
theme_bw() +
theme(legend.position = "none")
print(p_mes)
theme_bw() +
theme(
axis.text.x = element_text(size=rel(1.2), angle=60, hjust=1, vjust=1, color="black"),
legend.position = "none",
)
theme_bw() +
theme(
axis.text.x = element_text(size=rel(1.2), angle=60, hjust=1, vjust=1, color="black"),
legend.position = "none"
)
p_mes <- ggplot(foo, aes(x=anno, y=N)) +
geom_bar(aes(fill=assay), stat="identity", position="dodge", color="black", size=0.25) +
scale_fill_manual(values=c("Nmet"="#F37A71", "Nacc"="#00BFC4")) +
facet_wrap(~assay, nrow=2) +
labs(x="", y="Fraction of differential sites")
p_mes <- ggplot(foo, aes(x=anno, y=N)) +
geom_bar(aes(fill=assay), stat="identity", position="dodge", color="black", size=0.25) +
scale_fill_manual(values=c("Nmet"="#F37A71", "Nacc"="#00BFC4")) +
facet_wrap(~assay, nrow=2) +
labs(x="", y="Fraction of differential sites") +
theme_bw() +
theme(
axis.text.x = element_text(size=rel(1.2), angle=60, hjust=1, vjust=1, color="black"),
legend.position = "none"
)
print(p_mes)
p_mes <- ggplot(foo, aes(x=anno, y=N, group=assay)) +
geom_bar(aes(fill=assay), stat="identity", position="dodge", color="black", size=0.25) +
scale_fill_manual(values=c("Nmet"="#F37A71", "Nacc"="#00BFC4")) +
# facet_wrap(~assay, nrow=2) +
labs(x="", y="Fraction of differential sites") +
theme_bw() +
theme(
axis.text.x = element_text(size=rel(1.2), angle=60, hjust=1, vjust=1, color="black"),
legend.position = "none"
)
print(p_mes)
tmp <- diff.metaccrna %>%
.[,.(Nmet=mean(sig_met,na.rm=T), Nacc=mean(sig_acc,na.rm=T)), by=c("anno","lineage")] %>%
melt(id.vars=c("anno","lineage"), variable.name="assay", value.name="N")
# Mesoderm
# foo <- tmp[grep("End|Ect",anno,invert=T)] %>% .[lineage=="Mesoderm"]
foo <- tmp[lineage=="Mesoderm"]
p_mes <- ggplot(foo, aes(x=anno, y=N, group=assay)) +
geom_bar(aes(fill=assay), stat="identity", position="dodge", color="black", size=0.25) +
scale_fill_manual(values=c("Nmet"="#F37A71", "Nacc"="#00BFC4")) +
# facet_wrap(~assay, nrow=2) +
labs(x="", y="Fraction of differential sites") +
theme_bw() +
theme(
axis.text.x = element_text(size=rel(1.2), angle=60, hjust=1, vjust=1, color="black"),
legend.position = "right"
)
print(p_mes)
# Endoderm
# foo <- tmp[lineage=="Endoderm"]
# p_end <- ggplot(foo, aes(x=anno, y=N)) +
#   geom_bar(stat="identity", position="dodge", color="black", size=0.25) +
#   facet_wrap(~assay, nrow=2) +
#   theme_bw()
# print(p_end)
p_mes <- ggplot(foo, aes(x=anno, y=N, group=assay)) +
geom_bar(aes(fill=assay), stat="identity", position="dodge", color="black", size=0.25) +
scale_fill_manual(values=c("Nmet"="#F37A71", "Nacc"="#00BFC4")) +
# facet_wrap(~assay, nrow=2) +
labs(x="", y="Fraction of differential sites") +
theme_bw() +
theme(
axis.text.x = element_text(size=rel(1.2), angle=60, hjust=1, vjust=1, color="black"),
axis.text.y = element_text(size=rel(1.2), color="black"),
legend.position = "right"
)
print(p_mes)
p_mes <- ggplot(foo, aes(x=anno, y=N, group=assay)) +
geom_bar(aes(fill=assay), stat="identity", position="dodge", color="black", size=0.25) +
scale_fill_manual(values=c("Nmet"="#F37A71", "Nacc"="#00BFC4")) +
# facet_wrap(~assay, nrow=2) +
labs(x="", y="Fraction of differential sites") +
theme_bw() +
theme(
axis.text.x = element_text(size=rel(1.2), angle=60, hjust=1, vjust=1, color="black"),
axis.text.y = element_text(size=rel(1.2), color="black"),
axis.title.y = element_text(size=rel(1.2), color="black"),
legend.position = "right"
)
print(p_mes)
# Endoderm
foo <- tmp[lineage=="Endoderm"]
p_end <- ggplot(foo, aes(x=anno, y=N, group=assay)) +
geom_bar(aes(fill=assay), stat="identity", position="dodge", color="black", size=0.25) +
scale_fill_manual(values=c("Nmet"="#F37A71", "Nacc"="#00BFC4")) +
labs(x="", y="Fraction of differential sites") +
theme_bw() +
theme(
axis.text.x = element_text(size=rel(1.2), angle=60, hjust=1, vjust=1, color="black"),
axis.text.y = element_text(size=rel(1.2), color="black"),
axis.title.y = element_text(size=rel(1.2), color="black"),
legend.position = "right"
)
print(p_edn)
print(p_end)
pdf(paste0(io$outdir,"/mes_fractionsigcor.pdf"), width=7, height=6, useDingbats = F)
print(p_mes)
dev.off()
io$outdir
io$outdir <- "/Users/ricard/gastrulation/metaccrna/differential/out"
library(data.table)
library(purrr)
library(ggplot2)
theme_pb <- function() {
theme(
axis.text.x = element_text(size=rel(1.7), color="black", angle=50, vjust=1, hjust=1),
axis.text.y = element_text(size=rel(1.2), color="black"),
axis.title.y = element_text(size=rel(1.4), color="black"),
strip.background = element_rect(fill="#F37A71"),
strip.text = element_text(size=rel(2.4), color="black"),
# strip.text.x = element_text(size=rel(1.45), color="black"),
legend.position="top",
legend.title = element_blank()
)
}
## Define I/O ##
io <- list()
io$sample.metadata <- "/Users/ricard/data/gastrulation/sample_metadata_scNMT.txt"
io$met.dir <- "/Users/ricard/data/gastrulation/met/parsed"
io$acc.dir <- "/Users/ricard/data/gastrulation/acc/parsed"
io$rna.file <- "/Users/ricard/data/gastrulation/rna/parsed/sceset_scNMT.rds"
io$outdir <- "/Users/ricard/gastrulation/metaccrna/differential/out"
io$annos_dir <- "/Users/ricard/data/gastrulation/features/filt"
io$gene_metadata <- "/Users/ricard/data/ensembl/mouse/v87/BioMart/mRNA/Mmusculus_genes_BioMart.87.txt"
## Define options ##
opts <- list()
# Define genomic contexts for methylation
opts$met.annos <- c(
# "genebody"="Gene body",
"prom_2000_2000"="Promoters",
# "prom_2000_2000_cgi"="CGI promoters",
# "prom_2000_2000_noncgi"="non-CGI promoters",
"H3K27ac_distal_E7.5_Mes_500"="Mes Distal H3K27ac",
"H3K27ac_distal_E7.5_End_500"="End Distal H3K27ac",
"H3K27ac_distal_E7.5_Ect_500"="Ect Distal H3K27ac",
"H3K4me3_E7.5_Mes"="Mes H3K4me3",
"H3K4me3_E7.5_End"="End H3K4me3",
"H3K4me3_E7.5_Ect"="Ect H3K4me3"
)
# Define genomic contexts for accessibility
opts$acc.annos <- c(
# "genebody"="Gene body",
"prom_200_200"="Promoters",
# "prom_200_200_cgi"="CGI promoters",
# "prom_200_200_noncgi"="non-CGI promoters",
"H3K27ac_distal_E7.5_Mes"="Mes Distal H3K27ac",
"H3K27ac_distal_E7.5_End"="End Distal H3K27ac",
"H3K27ac_distal_E7.5_Ect"="Ect Distal H3K27ac",
"H3K4me3_E7.5_Mes"="Mes H3K4me3",
"H3K4me3_E7.5_End"="End H3K4me3",
"H3K4me3_E7.5_Ect"="Ect H3K4me3"
)
# Overlap differential sites with nearby genes
opts$overlapGenes <- TRUE
# window length for the overlap between genes and features
opts$gene_window <- 25000
# annos <- unique(c(names(opts$met.annos),names(opts$acc.annos)))
# Load genomic context metadata
feature_metadata <- lapply(names(opts$met.annos), function(anno)
fread(sprintf("%s/%s.bed",io$annos_dir,anno), stringsAsFactors=T)[,c(1,2,3,4,5,6)]) %>%
rbindlist %>% setnames(c("chr", "start", "end", "strand", "id", "anno"))
# Load gene metadata
gene_metadata <- fread(io$gene_metadata,stringsAsFactors=T) %>%
setnames(c("ens_id","symbol"),c("id","gene")) %>%
.[,chr:=as.factor(substr(chr,4,4))]
io$diff.rna <- "/Users/ricard/gastrulation/rna/differential/out"
# Endoderm
diff.rna.end <- fread(paste0(io$diff.rna,"/E7.5End_vs_E7.5MesEct.tsv")) %>% .[,lineage:="Endoderm"]
diff.rna.mes <- fread(paste0(io$diff.rna,"/E7.5Mes_vs_E7.5EndEct.tsv")) %>% .[,lineage:="Mesoderm"]
diff.rna.ect <- fread(paste0(io$diff.rna,"/E7.5Ect_vs_E7.5MesEnd.tsv")) %>% .[,lineage:="Ectoderm"]
diff.rna <- do.call("rbind", list(diff.rna.end,diff.rna.mes,diff.rna.ect)) %>%
# .[,sig:=logFC<(-2) & padj_fdr<0.01] %>%
.[,sig:=logFC<abs(-2) & padj_fdr<0.01] %>%
.[,sig:=ifelse(is.na(sig),FALSE,sig)] %>%
setnames(c("id","logFC","sig","padj_fdr","log_padj_fdr","symbol"),c("ens_id","diff_rna","sig_rna","padj_fdr_rna","log_padj_fdr_rna","gene")) %>%
.[,c("ens_id","gene","diff_rna","padj_fdr_rna","log_padj_fdr_rna","sig_rna","lineage")]
io$diff.met <- "/Users/ricard/data/gastrulation_norsync_stuff/met/test/diff_featurelevel"
# Mesoderm-specific
diff.met.mes <- lapply(names(opts$met.annos), function(x)
fread(sprintf("zcat < %s/E7.5Mes_vs_E7.5EctEnd_%s.txt.gz",io$diff.met,x))
) %>% rbindlist() %>% .[,lineage:="Mesoderm"]
# Ectoderm-specific
diff.met.ect <- lapply(names(opts$met.annos), function(x)
fread(sprintf("zcat < %s/E7.5Ect_vs_E7.5MesEnd_%s.txt.gz",io$diff.met,x))
) %>% rbindlist() %>% .[,lineage:="Ectoderm"]
# Endoderm-specific
diff.met.end <- lapply(names(opts$met.annos), function(x)
fread(sprintf("zcat < %s/E7.5End_vs_E7.5EctMes_%s.txt.gz",io$diff.met,x))
) %>% rbindlist() %>% .[,lineage:="Endoderm"]
diff.met <- do.call("rbind", list(diff.met.mes,diff.met.end,diff.met.ect))# %>%
# .[,sig:=padj_fdr<0.01 & abs(diff)>0.10]
io$diff.acc <- "/Users/ricard/data/gastrulation_norsync_stuff/acc/test/diff_featurelevel"
# Mesoderm-specific
diff.acc.mes <- lapply(names(opts$acc.annos), function(x)
fread(sprintf("zcat < %s/E7.5Mes_vs_E7.5EctEnd_%s.txt.gz",io$diff.acc,x))
) %>% rbindlist() %>% .[,lineage:="Mesoderm"]
# Ectoderm-specific
diff.acc.ect <- lapply(names(opts$acc.annos), function(x)
fread(sprintf("zcat < %s/E7.5Ect_vs_E7.5MesEnd_%s.txt.gz",io$diff.acc,x))
) %>% rbindlist() %>% .[,lineage:="Ectoderm"]
# Endoderm-specific
diff.acc.end <- lapply(names(opts$acc.annos), function(x)
fread(sprintf("zcat < %s/E7.5End_vs_E7.5EctMes_%s.txt.gz",io$diff.acc,x))
) %>% rbindlist() %>% .[,lineage:="Endoderm"]
diff.acc <- do.call("rbind", list(diff.acc.mes,diff.acc.end,diff.acc.ect))# %>%
# .[,sig:=padj_fdr<0.01 & abs(diff)>0.15]
diff.met <- diff.met %>%
.[,anno:=stringr::str_replace_all(anno,opts$met.annos)] %>%
.[,id:=stringr::str_replace_all(id,"_500","")] %>%
.[,c("id","anno","diff","padj_fdr","sig","lineage")]
diff.acc <- diff.acc %>%
.[,anno:=stringr::str_replace_all(anno,opts$acc.annos)] %>%
.[,c("id","anno","diff","padj_fdr","sig","lineage")]
diff.metacc <- rbind(
diff.met[,type:="met"],
diff.acc[,type:="acc"]
) %>% dcast(id+anno+lineage~type, value.var=c("padj_fdr","diff","sig"))# %>% .[complete.cases(.)]
feature_metadata_filt <- feature_metadata %>% copy %>%
.[,anno:=stringr::str_replace_all(anno,opts$met.annos)] %>%
.[,id:=stringr::str_replace_all(id,"_500","")] %>%
split(.$anno) %>%
map2(.,names(.), function(x,y) x[id %in% unique(as.character(diff.metacc[anno==y,id]))] ) %>%
rbindlist
gene_metadata_filt <- gene_metadata %>% .[,c("chr","start","end","gene")] %>%
.[,c("start", "end") := list(start-opts$gene_window, end+opts$gene_window)] %>%
setkey(chr,start,end)
tmp_list <- list()
for (ann in unique(diff.metacc$anno)){
# Subset corresponding anno
tmp <- diff.metacc[anno==ann, ]
# Non gene-associated feature
if (all(grepl("ENSMUSG", unique(tmp$id)) == FALSE)) {
# Extract coordiantes for methylation sites and for genes
feature_metadata_tmp <- feature_metadata_filt[anno==ann, c("chr","start","end","id")] %>%
.[,c("start","end") := list(start - opts$gene_window, end + opts$gene_window)] %>% setkey(chr,start,end)
# Do the overlap
ov <- foverlaps(gene_metadata_filt, feature_metadata_tmp, nomatch=0) %>% .[,c("gene", "id")]
# Merge with methylation data
tmp_list[[ann]] <- merge(tmp, ov, by="id", allow.cartesian=T)
}
# Gene-associated feature
else if (all(grepl("ENSMUSG", unique(tmp$id)) == TRUE)) {
tmp_list[[ann]] <- merge(tmp, gene_metadata[,c("id","gene")], by="id")
}
}
diff.metacc <- rbindlist(tmp_list)
diff.metacc <- diff.metacc %>% split(.$anno) %>% map(~ .[,.SD[which.min(padj_fdr_met)], by=c("gene","lineage")]) %>% rbindlist
diff.metaccrna <- diff.metacc %>% merge(diff.rna[,c("gene","diff_rna","sig_rna","lineage")], by=c("gene","lineage"))
tmp <- diff.metaccrna %>%
.[,.(Nmet=mean(sig_met,na.rm=T), Nacc=mean(sig_acc,na.rm=T)), by=c("anno","lineage")] %>%
melt(id.vars=c("anno","lineage"), variable.name="assay", value.name="N")
# Mesoderm
# foo <- tmp[grep("End|Ect",anno,invert=T)] %>% .[lineage=="Mesoderm"]
foo <- tmp[lineage=="Mesoderm"]
p_mes <- ggplot(foo, aes(x=anno, y=N, group=assay)) +
geom_bar(aes(fill=assay), stat="identity", position="dodge", color="black", size=0.25) +
scale_fill_manual(values=c("Nmet"="#F37A71", "Nacc"="#00BFC4")) +
labs(x="", y="Fraction of differential sites") +
theme_bw() +
theme(
axis.text.x = element_text(size=rel(1.2), angle=60, hjust=1, vjust=1, color="black"),
axis.text.y = element_text(size=rel(1.2), color="black"),
axis.title.y = element_text(size=rel(1.2), color="black"),
legend.position = "right"
)
pdf(paste0(io$outdir,"/mes_fractionsigcor.pdf"), width=7, height=6, useDingbats = F)
print(p_mes)
dev.off()
# Endoderm
# foo <- tmp[lineage=="Endoderm"]
# p_end <- ggplot(foo, aes(x=anno, y=N, group=assay)) +
#   geom_bar(aes(fill=assay), stat="identity", position="dodge", color="black", size=0.25) +
#   scale_fill_manual(values=c("Nmet"="#F37A71", "Nacc"="#00BFC4")) +
#   labs(x="", y="Fraction of differential sites") +
#   theme_bw() +
#   theme(
#     axis.text.x = element_text(size=rel(1.2), angle=60, hjust=1, vjust=1, color="black"),
#     axis.text.y = element_text(size=rel(1.2), color="black"),
#     axis.title.y = element_text(size=rel(1.2), color="black"),
#     legend.position = "right"
#     )
# print(p_end)
pdf(paste0(io$outdir,"/mes_fractionsigcor.pdf"), width=8, height=6, useDingbats = F)
print(p_mes)
dev.off()
pdf(paste0(io$outdir,"/mes_fractionsigcor.pdf"), width=8, height=5)
print(p_mes)
dev.off()
# Endoderm
foo <- tmp[lineage=="Endoderm"]
p_end <- ggplot(foo, aes(x=anno, y=N, group=assay)) +
geom_bar(aes(fill=assay), stat="identity", position="dodge", color="black", size=0.25) +
scale_fill_manual(values=c("Nmet"="#F37A71", "Nacc"="#00BFC4")) +
labs(x="", y="Fraction of differential sites") +
theme_bw() +
theme(
axis.text.x = element_text(size=rel(1.2), angle=60, hjust=1, vjust=1, color="black"),
axis.text.y = element_text(size=rel(1.2), color="black"),
axis.title.y = element_text(size=rel(1.2), color="black"),
legend.position = "right"
)
pdf(paste0(io$outdir,"/end_fractionsigcor.pdf"), width=8, height=5)
print(p_end)
dev.off()
p_mes <- ggplot(foo, aes(x=anno, y=N, group=assay)) +
geom_bar(aes(fill=assay), stat="identity", position="dodge", color="black", size=0.25) +
scale_fill_manual(values=c("Nmet"="#F37A71", "Nacc"="#00BFC4")) +
labs(x="", y="Fraction of differential sites") +
coord_cartesian(ylim=c(0,0.35)) +
theme_bw() +
theme(
axis.text.x = element_text(size=rel(1.2), angle=60, hjust=1, vjust=1, color="black"),
axis.text.y = element_text(size=rel(1.2), color="black"),
axis.title.y = element_text(size=rel(1.2), color="black"),
legend.position = "right"
)
print(p_mes)
p_mes <- ggplot(foo, aes(x=anno, y=N, group=assay)) +
geom_bar(aes(fill=assay), stat="identity", position="dodge", color="black", size=0.25) +
scale_fill_manual(values=c("Nmet"="#F37A71", "Nacc"="#00BFC4")) +
labs(x="", y="Fraction of differential sites") +
coord_cartesian(ylim=c(0,0.3)) +
theme_bw() +
theme(
axis.text.x = element_text(size=rel(1.2), angle=60, hjust=1, vjust=1, color="black"),
axis.text.y = element_text(size=rel(1.2), color="black"),
axis.title.y = element_text(size=rel(1.2), color="black"),
legend.position = "right"
)
print(p_mes)
# Mesoderm
# foo <- tmp[grep("End|Ect",anno,invert=T)] %>% .[lineage=="Mesoderm"]
foo <- tmp[lineage=="Mesoderm"]
p_mes <- ggplot(foo, aes(x=anno, y=N, group=assay)) +
geom_bar(aes(fill=assay), stat="identity", position="dodge", color="black", size=0.25) +
scale_fill_manual(values=c("Nmet"="#F37A71", "Nacc"="#00BFC4")) +
labs(x="", y="Fraction of differential sites") +
coord_cartesian(ylim=c(0,0.3)) +
theme_bw() +
theme(
axis.text.x = element_text(size=rel(1.2), angle=60, hjust=1, vjust=1, color="black"),
axis.text.y = element_text(size=rel(1.2), color="black"),
axis.title.y = element_text(size=rel(1.2), color="black"),
legend.position = "right"
)
print(p_mes)
tmp <- diff.metaccrna %>%
.[,.(Nmet=mean(sig_met,na.rm=T), Nacc=mean(sig_acc,na.rm=T)), by=c("anno","lineage")] %>%
melt(id.vars=c("anno","lineage"), variable.name="assay", value.name="N")
# Mesoderm
# foo <- tmp[grep("End|Ect",anno,invert=T)] %>% .[lineage=="Mesoderm"]
foo <- tmp[lineage=="Mesoderm"]
p_mes <- ggplot(foo, aes(x=anno, y=N, group=assay)) +
geom_bar(aes(fill=assay), stat="identity", position="dodge", color="black", size=0.25) +
scale_fill_manual(values=c("Nmet"="#F37A71", "Nacc"="#00BFC4")) +
labs(x="", y="Fraction of differential sites") +
coord_cartesian(ylim=c(0,0.3)) +
theme_bw() +
theme(
axis.text.x = element_text(size=rel(1.2), angle=60, hjust=1, vjust=1, color="black"),
axis.text.y = element_text(size=rel(1.2), color="black"),
axis.title.y = element_text(size=rel(1.2), color="black"),
legend.position = "right"
)
pdf(paste0(io$outdir,"/mes_fractionsigcor.pdf"), width=8, height=5)
print(p_mes)
dev.off()
# Endoderm
foo <- tmp[lineage=="Endoderm"]
p_end <- ggplot(foo, aes(x=anno, y=N, group=assay)) +
geom_bar(aes(fill=assay), stat="identity", position="dodge", color="black", size=0.25) +
scale_fill_manual(values=c("Nmet"="#F37A71", "Nacc"="#00BFC4")) +
labs(x="", y="Fraction of differential sites") +
coord_cartesian(ylim=c(0,0.3)) +
theme_bw() +
theme(
axis.text.x = element_text(size=rel(1.2), angle=60, hjust=1, vjust=1, color="black"),
axis.text.y = element_text(size=rel(1.2), color="black"),
axis.title.y = element_text(size=rel(1.2), color="black"),
legend.position = "right"
)
pdf(paste0(io$outdir,"/end_fractionsigcor.pdf"), width=8, height=5)
print(p_end)
dev.off()
# Ectoderm
foo <- tmp[lineage=="Ectoderm"]
p_ect <- ggplot(foo, aes(x=anno, y=N, group=assay)) +
geom_bar(aes(fill=assay), stat="identity", position="dodge", color="black", size=0.25) +
scale_fill_manual(values=c("Nmet"="#F37A71", "Nacc"="#00BFC4")) +
labs(x="", y="Fraction of differential sites") +
coord_cartesian(ylim=c(0,0.3)) +
theme_bw() +
theme(
axis.text.x = element_text(size=rel(1.2), angle=60, hjust=1, vjust=1, color="black"),
axis.text.y = element_text(size=rel(1.2), color="black"),
axis.title.y = element_text(size=rel(1.2), color="black"),
legend.position = "right"
)
# pdf(paste0(io$outdir,"/end_fractionsigcor.pdf"), width=8, height=5)
print(p_ect)
